(function () {
    'use strict';

    function startPlugin() {
        // Додаємо пункт у список параметрів
        Lampa.Settings.add({
            title: 'Тест',
            type: 'open', // Тип 'open' вказує, що при натисканні відкриється нова панель
            icon: '<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>',
            name: 'my_test_section',
            parent: 'main' // Додаємо в головний розділ налаштувань
        });

        // Слухаємо подію відкриття саме нашого розділу
        Lampa.Listener.follow('settings', function (e) {
            if (e.type == 'open' && e.name == 'my_test_section') {
                var body = e.body; // Права частина екрану налаштувань
                
                // Очищуємо контейнер
                body.empty();

                // Створюємо елемент у стилі Lampa
                var item = $(`
                    <div class="settings-list">
                        <div class="settings-list__item selector">
                            <div class="settings-list__title">Повідомлення</div>
                            <div class="settings-list__descr" style="color: #fff !important;">привіт</div>
                        </div>
                    </div>
                `);

                body.append(item);

                // Оновлюємо контролер, щоб пульт "бачив" елемент
                Lampa.Controller.add('settings_test_page', {
                    toggle: function () {
                        Lampa.Controller.collectionSet(body);
                        Lampa.Controller.navigate();
                    },
                    back: function () {
                        Lampa.Settings.main();
                    }
                });

                Lampa.Controller.toggle('settings_test_page');
            }
        });
    }

    // Перевірка готовності Lampa
    if (window.appready) {
        startPlugin();
    } else {
        Lampa.Listener.follow('app', function (e) {
            if (e.type == 'ready') startPlugin();
        });
    }
})();
